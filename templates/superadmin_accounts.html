{% extends 'base.html' %}
{% block title %}Super Admin · Manage Accounts{% endblock %}
{% block content %}
<section class="hero"><div class="hero-bg"></div></section>
<div class="container">
  {% for m in get_flashed_messages(with_categories=true) %}
    <div class="flash {{ m[0] }}">{{ m[1] }}</div>
  {% endfor %}

  <div class="admin-hero">
    <span class="badge">Management</span>
    <h1 class="strong">Manage Accounts</h1>
  </div>

  <form method="get" class="form glass" style="grid-template-columns: 1fr auto; align-items: flex-end; gap: 1rem; margin-bottom: 2rem; max-width: 400px;">
    <label>Filter by role
      <select name="role">
        <option value="">All Roles</option>
        <option value="Admin">Admin</option>
        <option value="Staff">Staff</option>
        <option value="Dentist">Dentist</option>
      </select>
    </label>
    <button class="btn btn-primary" type="submit">Apply</button>
  </form>

  <table class="table glass">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td><strong>{{ u.acc_id }}</strong></td>
        <td>{{ u.acc_name }}</td>
        <td>{{ u.acc_email }}</td>
        <td><span class="chip">{{ u.acc_role }}</span></td>
        <td>
          {% if u.acc_status == 'Approved' %}
            <span class="chip" style="background: rgba(34, 197, 94, 0.15); color: var(--success);">{{ u.acc_status }}</span>
          {% elif u.acc_status == 'Pending Approval' %}
            <span class="chip" style="background: rgba(250, 204, 21, 0.15); color: #ca8a04;">{{ u.acc_status }}</span>
          {% else %}
            <span class="chip" style="background: rgba(239, 68, 68, 0.15); color: var(--danger);">{{ u.acc_status }}</span>
          {% endif %}
        </td>
        <td>
          <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
            <form method="post" action="/super-admin/approve" style="display: flex; gap: 0.25rem; align-items: center;">
              <input type="hidden" name="acc_id" value="{{ u.acc_id }}" />
              <select name="action" style="padding: 0.4rem; border-radius: 0.4rem; border: 1px solid var(--border); font-size: 0.85rem;">
                <option>Approve</option>
                <option>Reject</option>
                <option>Deactivate</option>
                <option>Reactivate</option>
              </select>
              <button class="btn btn-outline" type="submit" style="padding: 0.4rem 0.75rem; font-size: 0.8rem;">✓</button>
            </form>
            <form method="post" action="/super-admin/delete" style="display: inline;" onsubmit="return confirm('Delete this account?')">
              <input type="hidden" name="acc_id" value="{{ u.acc_id }}" />
              <button class="btn btn-danger" type="submit" style="padding: 0.4rem 0.75rem; font-size: 0.8rem;">✕</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if users|length == 0 %}
    <div style="text-align: center; padding: 2rem; color: var(--muted);">
      <p>No accounts found.</p>
    </div>
  {% endif %}

  <div style="text-align: center; margin-top: 2rem; padding-bottom: 2rem;">
    <a href="/super-admin" class="btn btn-outline">← Back to Dashboard</a>
  </div>
</div>
{% endblock %}
